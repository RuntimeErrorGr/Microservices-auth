{% block metas %}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
{% endblock %}

<title>{% block title %}My App{% endblock %}</title>

{% block styles %}
<style>
    body {
        display: flex;
        flex-direction: row;
        min-height: 100vh;
        margin: 0;
    }
</style>

<style>
    #book-rating span {
        font-size: 1.5rem;
        margin: 0 2px;
    }
</style>

{% endblock %}

<!-- Vertical Navbar -->
<nav class="bg-blue-900 w-64 flex-shrink-0 flex flex-col rounded-md">
    <div class="bg-blue-800 text-white text-center py-2 h-16 flex items-center justify-center font-semibold text-lg">
        Menu
    </div>
    <div class="flex-1">
        <ul class="space-y-2 p-4">
            <li>
                <a href="{{ url_for('auth.dashboard') }}" class="block text-blue-300 hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-base font-medium">
                    Dashboard
                </a>
            </li>
            <li>
                <a href="#" class="block text-blue-300 hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-base font-medium">
                    Profile
                </a>
            </li>
            <li>
                <a href="#" class="block text-blue-300 hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-base font-medium">
                    Settings
                </a>
            </li>
            <li>
                <a href="#" class="block text-blue-300 hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-base font-medium">
                    Help
                </a>
            </li>
        </ul>
    </div>
</nav>

<!-- Main Content -->
<div style="flex: 1; display: flex; flex-direction: column;">
    <!-- Horizontal Navbar -->
    <nav class="bg-blue-800 px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
        <div class="text-white text-lg font-medium rounded-md">
            {% if role == 'guest' %}
                Looks like you are just passing by. If you want to unblock more features, <a href="#" class="text-white rounded-md hover:bg-blue-100 font-bold underline" onclick="handleLogout()">login</a>.
            {% else %}
                Hi, <strong>{{ username }}</strong> <span class="text-blue-300"> | {{ role }}</span>
            {% endif %}
        </div>
        <div class="flex items-center space-x-4">
            {% if role != 'guest' %}
                <button id="logout-button" onClick="handleLogout()"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md shadow-sm">
                    Logout
                </button>
            {% endif %}
        </div>
    </nav>

    <!-- Page Content -->
    <main class="p-6 bg-blue-100 flex-1">
        {% block content %}
        {% endblock %}
    </main>
</div>

{% block scripts %}
<script>
    function displayErrorMessage(sectionId, errorMessage) {
        document.getElementById(sectionId).innerHTML = `
            <div class="bg-red-100 text-red-700 px-4 py-2 rounded-md">
                ${errorMessage}
            </div>
        `;
    }

    function displayErrorMessageWithWhiteBorder(sectionId, errorMessage) {
        document.getElementById(sectionId).innerHTML = `
            <div class="mb-8 bg-white border border-gray-200 shadow-md rounded-lg px-6 py-10">
                <div class="bg-red-100 text-red-700 px-4 py-2 rounded-md">
                    ${errorMessage}
                </div>
            </div>
        `;
    }

    function displayErrorMessageWithWhiteBorderAndButtonModal(errorMessage, buttonId, buttonText, closeAction) {
        const modal = document.createElement('div');
        modal.classList.add('fixed', 'inset-0', 'bg-black', 'bg-opacity-50', 'flex', 'justify-center', 'items-center', 'z-50');

        const modalContent = document.createElement('div');
        modalContent.classList.add('bg-white', 'p-6', 'rounded-md', 'shadow-lg', 'max-w-sm', 'w-full');

        const errorDiv = document.createElement('div');
        errorDiv.classList.add('bg-red-100', 'text-red-700', 'px-4', 'py-2', 'rounded-md');
        errorDiv.innerHTML = errorMessage;

        const buttonContainer = document.createElement('div');
        buttonContainer.classList.add('flex', 'justify-center', 'mt-4');
        
        const button = document.createElement('button');
        button.id = buttonId;
        button.classList.add('bg-blue-500', 'text-white', 'px-4', 'py-2', 'rounded-md', 'hover:bg-blue-700');
        button.textContent = buttonText;

        buttonContainer.appendChild(button);
        modalContent.appendChild(errorDiv);
        modalContent.appendChild(buttonContainer);
        modal.appendChild(modalContent);

        document.body.appendChild(modal);

        button.addEventListener('click', () => {
            closeAction(); 
            document.body.removeChild(modal);
        });
    }

    function displaySuccessMessageWithWhiteBorderAndButtonModal(successMessage, buttonId, buttonText, closeAction) {
        const modal = document.createElement('div');
        modal.classList.add('fixed', 'inset-0', 'bg-black', 'bg-opacity-50', 'flex', 'justify-center', 'items-center', 'z-50');

        const modalContent = document.createElement('div');
        modalContent.classList.add('bg-white', 'p-6', 'rounded-md', 'shadow-lg', 'max-w-sm', 'w-full');

        const successDiv = document.createElement('div');
        successDiv.classList.add('bg-green-100', 'text-green-700', 'px-4', 'py-2', 'rounded-md');
        successDiv.innerHTML = successMessage;

        const buttonContainer = document.createElement('div');
        buttonContainer.classList.add('flex', 'justify-center', 'mt-4');
        
        const button = document.createElement('button');
        button.id = buttonId;
        button.classList.add('bg-blue-500', 'text-white', 'px-4', 'py-2', 'rounded-md', 'hover:bg-blue-700');
        button.textContent = buttonText;

        buttonContainer.appendChild(button);
        modalContent.appendChild(successDiv);
        modalContent.appendChild(buttonContainer);
        modal.appendChild(modalContent);

        document.body.appendChild(modal);

        button.addEventListener('click', () => {
            closeAction(); 
            document.body.removeChild(modal);
        });
    }



    function generatePermissionErrorMessage(roleName, actionName, resourceName) {
        return `Your role <strong>${roleName}</strong> does not have permission to <strong>${actionName}</strong> the resource <strong>${resourceName}</strong>.`;
    }

    function getUserRole() {
        return "{{ role }}";
    }
</script>
<script src="{{ url_for('static', filename='tailwind/tailwind.css') }}"></script>
<script>
    window.handleLogout = async function () {
        try {
            const response = await fetch("{{ url_for('auth.logout') }}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
            });

            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    window.location.href = data.redirect;
                }
            } else {
                console.error("Logout request failed");
            }
        } catch (err) {
            console.error("Error during logout:", err);
        }
    }
</script>
{% endblock %}
